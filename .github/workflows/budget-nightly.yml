name: Budget Nightly Automation

on:
  schedule:
    # Run daily at 7:30 AM CT (12:30 PM UTC)
    - cron: '30 12 * * *'
  workflow_dispatch:  # Allow manual trigger

jobs:
  nightly-update:
    runs-on: ubuntu-latest
    steps:
      - name: Trigger Nightly Budget Update
        run: |
          echo "Starting nightly budget update workflow..."
          RESPONSE=$(curl -i --location --request POST 'https://us-central1-budgetcalendar-e6538.cloudfunctions.net/nightlyBudgetUpdate' \
            --header 'Content-Type: application/json' \
            --data '{}')
          echo "Response: $RESPONSE"
        continue-on-error: true

      - name: Check if workflow succeeded
        if: failure()
        run: |
          echo "::error::Nightly budget update failed. Check Firebase Functions logs for details."
          exit 1
